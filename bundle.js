var app=function(){"use strict";function e(){}function t(e){return e()}function r(){return Object.create(null)}function n(e){e.forEach(t)}function i(e){return"function"==typeof e}function o(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function s(e,t){e.appendChild(t)}function a(e,t,r){e.insertBefore(t,r||null)}function c(e){e.parentNode.removeChild(e)}function l(e){return document.createElement(e)}function u(e){return document.createTextNode(e)}function d(){return u(" ")}function f(e,t,r){null==r?e.removeAttribute(t):e.setAttribute(t,r)}function m(e,t){t=""+t,e.data!==t&&(e.data=t)}function p(e,t,r){e.classList[r?"add":"remove"](t)}let v;function h(e){v=e}function g(e){(function(){if(!v)throw new Error("Function called outside component initialization");return v})().$$.on_mount.push(e)}function y(){const e=v;return(t,r)=>{const n=e.$$.callbacks[t];if(n){const i=function(e,t){const r=document.createEvent("CustomEvent");return r.initCustomEvent(e,!1,!1,t),r}(t,r);n.slice().forEach(t=>{t.call(e,i)})}}}const w=[],$=[],C=[],b=[],x=Promise.resolve();let L=!1;function E(e){C.push(e)}function S(){const e=new Set;do{for(;w.length;){const e=w.shift();h(e),_(e.$$)}for(;$.length;)$.pop()();for(let t=0;t<C.length;t+=1){const r=C[t];e.has(r)||(r(),e.add(r))}C.length=0}while(w.length);for(;b.length;)b.pop()();L=!1}function _(e){e.fragment&&(e.update(e.dirty),n(e.before_update),e.fragment.p(e.dirty,e.ctx),e.dirty=null,e.after_update.forEach(E))}const k=new Set;let j;function A(e,t){e&&e.i&&(k.delete(e),e.i(t))}function M(e,t,r,n){if(e&&e.o){if(k.has(e))return;k.add(e),j.c.push(()=>{k.delete(e),n&&(r&&e.d(1),n())}),e.o(t)}}function P(e,r,o){const{fragment:s,on_mount:a,on_destroy:c,after_update:l}=e.$$;s.m(r,o),E(()=>{const r=a.map(t).filter(i);c?c.push(...r):n(r),e.$$.on_mount=[]}),l.forEach(E)}function T(e,t){e.$$.fragment&&(n(e.$$.on_destroy),e.$$.fragment.d(t),e.$$.on_destroy=e.$$.fragment=null,e.$$.ctx={})}function q(e,t){e.$$.dirty||(w.push(e),L||(L=!0,x.then(S)),e.$$.dirty=r()),e.$$.dirty[t]=!0}function O(t,i,o,s,a,c){const l=v;h(t);const u=i.props||{},d=t.$$={fragment:null,ctx:null,props:c,update:e,not_equal:a,bound:r(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(l?l.$$.context:[]),callbacks:r(),dirty:null};let f=!1;var m;d.ctx=o?o(t,u,(e,r,n=r)=>(d.ctx&&a(d.ctx[e],d.ctx[e]=n)&&(d.bound[e]&&d.bound[e](n),f&&q(t,e)),r)):u,d.update(),f=!0,n(d.before_update),d.fragment=s(d.ctx),i.target&&(i.hydrate?d.fragment.l((m=i.target,Array.from(m.childNodes))):d.fragment.c(),i.intro&&A(t.$$.fragment),P(t,i.target,i.anchor),S()),h(l)}class G{$destroy(){T(this,1),this.$destroy=e}$on(e,t){const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{const e=r.indexOf(t);-1!==e&&r.splice(e,1)}}$set(){}}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var I,z,D=(function(e,t){!function(e){var t="4.13",r="next";function n(e){if(e.toLowerCase()===r)return r;var t=e&&e.match(/^(\d)\.(\d+)/);return t&&{major:parseInt(t[1],10),minor:parseInt(t[2],10)}}function i(e){return void 0===e&&(e=t),"https://js.arcgis.com/"+e+"/"}function o(e){return!e||n(e)?function(e){void 0===e&&(e=t);var o=i(e),s=n(e);if(s!==r&&3===s.major){var a=s.minor<=10?"js/":"";return""+o+a+"esri/css/esri.css"}return o+"esri/themes/light/main.css"}(e):e}function s(e,t){var r=o(e),n=function(e){return document.querySelector('link[href*="'+e+'"]')}(r);return n||function(e,t){if(t){var r=document.querySelector(t);r.parentNode.insertBefore(e,r)}else document.head.appendChild(e)}(n=function(e){var t=document.createElement("link");return t.rel="stylesheet",t.href=e,t}(r),t),n}var a={Promise:"undefined"!=typeof window?window.Promise:void 0};function c(e,t,r){var n;r&&(n=function(e,t){var r=function(n){t(n.error||new Error("There was an error attempting to load "+e.src)),e.removeEventListener("error",r,!1)};return e.addEventListener("error",r,!1),r}(e,r));var i=function(){t(e),e.removeEventListener("load",i,!1),n&&e.removeEventListener("error",n,!1)};e.addEventListener("load",i,!1)}function l(){return document.querySelector("script[data-esri-loader]")}function u(){var e=window.require;return e&&e.on}function d(e){void 0===e&&(e={});var t=e.version,r=e.url||i(t);return new a.Promise(function(n,i){var o=l();if(o){var a=o.getAttribute("src");a!==r?i(new Error("The ArcGIS API for JavaScript is already loaded ("+a+").")):u()?n(o):c(o,n,i)}else if(u())i(new Error("The ArcGIS API for JavaScript is already loaded."));else{var d=e.css;if(d){var f=!0===d;s(f?t:d,e.insertCssBefore)}e.dojoConfig&&(window.dojoConfig=e.dojoConfig),c(o=function(e){var t=document.createElement("script");return t.type="text/javascript",t.src=e,t.setAttribute("data-esri-loader","loading"),t}(r),function(){o.setAttribute("data-esri-loader","loaded"),n(o)},i),document.body.appendChild(o)}})}function f(e){return new a.Promise(function(t,r){var n=window.require.on("error",r);window.require(e,function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];n.remove(),t(e)})})}function m(e,t){if(void 0===t&&(t={}),u())return f(e);var r=l(),n=r&&r.getAttribute("src");return!t.url&&n&&(t.url=n),d(t).then(function(){return f(e)})}var p={getScript:l,isLoaded:u,loadModules:m,loadScript:d,loadCss:s,utils:a};e.getScript=l,e.isLoaded=u,e.loadModules=m,e.loadScript=d,e.loadCss=s,e.utils=a,e.default=p,Object.defineProperty(e,"__esModule",{value:!0})}(t)}(I={exports:{}},I.exports),I.exports);(z=D)&&z.__esModule&&Object.prototype.hasOwnProperty.call(z,"default")&&z.default;var H=D.loadModules;function N(t){var r;return{c(){(r=l("main")).innerHTML='<div id="viewDiv" class="svelte-1274iol"></div>',f(r,"class","svelte-1274iol")},m(e,t){a(e,r,t)},p:e,i:e,o:e,d(e){e&&c(r)}}}function B(e,t,r){let{selectedCrime:n="",crimes:i=""}=t;const o=y();let s,a,c;return H(["esri/Map","esri/views/MapView","esri/layers/GraphicsLayer","esri/Graphic","esri/geometry/Point"],{css:!0}).then(([e,t,n,i,l])=>{s=new e({basemap:"streets"}),r("view",a=new t({container:"viewDiv",map:s,zoom:12,center:[-90.28,38.6]})),r("graphicsLayer",c=new n),s.add(c),a.watch("popup.visible",e=>{!1===e&&o("selected",!1)}),a.on("click",function(e){a.hitTest(e).then(function(e){if(e.results.length){var t=e.results.filter(function(e){return e.graphic.layer===c})[0].graphic;o("selected",t.attributes)}else o("selected",!1)})})}).catch(e=>{console.error(e)}),e.$set=(e=>{"selectedCrime"in e&&r("selectedCrime",n=e.selectedCrime),"crimes"in e&&r("crimes",i=e.crimes)}),e.$$.update=((e={view:1,selectedCrime:1,graphicsLayer:1,crimes:1})=>{if((e.view||e.selectedCrime||e.graphicsLayer)&&a&&""!==n)if(!1===n)r("view",a.popup.visible=!1,a);else{r("view",a.center=[n.lon,n.lat],a);const e=c.graphics.find(e=>e.attributes.id===n.id);r("view",a.popup.features=[e],a),r("view",a.popup.location=e.geometry,a),r("view",a.popup.visible=!0,a)}(e.crimes||e.graphicsLayer)&&i&&i.length>0&&H(["esri/layers/GraphicsLayer","esri/Graphic","esri/geometry/Point"],{css:!0}).then(([e,t,r])=>{let n=i.map(e=>{if(e.lat&&e.lon){const n=new r({type:"point",latitude:e.lat,longitude:e.lon}),i={type:"simple-marker",style:"circle",color:"green",size:e.size+"px",outline:{color:[255,255,0],width:3}};return new t({geometry:n,symbol:i,attributes:e,popupTemplate:{title:e.offense,content:"{date}<br />{address}"}})}});c.removeAll(),c.addMany(n)})}),{selectedCrime:n,crimes:i}}class F extends G{constructor(e){super(),O(this,e,B,N,o,["selectedCrime","crimes"])}}function J(e,t,r){const n=Object.create(e);return n.crime=t[r],n}function U(e){var t,r,n,i,o,v,h,g,y,w,$,C,b=e.crime.offense+"",x=e.crime.date+"",L=e.crime.address+"";function E(){return e.click_handler(e)}return{c(){var s,a,c,m;t=l("div"),r=u(b),n=d(),i=l("br"),o=d(),v=u(x),h=d(),g=l("br"),y=d(),w=u(L),$=d(),f(t,"class","card svelte-3eenhg"),p(t,"highlight",e.selectedCrime&&e.crime.id===e.selectedCrime.id),a="click",c=E,(s=t).addEventListener(a,c,m),C=(()=>s.removeEventListener(a,c,m))},m(e,c){a(e,t,c),s(t,r),s(t,n),s(t,i),s(t,o),s(t,v),s(t,h),s(t,g),s(t,y),s(t,w),s(t,$)},p(n,i){e=i,n.values&&b!==(b=e.crime.offense+"")&&m(r,b),n.values&&x!==(x=e.crime.date+"")&&m(v,x),n.values&&L!==(L=e.crime.address+"")&&m(w,L),(n.selectedCrime||n.values)&&p(t,"highlight",e.selectedCrime&&e.crime.id===e.selectedCrime.id)},d(e){e&&c(t),C()}}}function X(t){var r;let n=t.values,i=[];for(let e=0;e<n.length;e+=1)i[e]=U(J(t,n,e));return{c(){for(let e=0;e<i.length;e+=1)i[e].c();r=u("")},m(e,t){for(let r=0;r<i.length;r+=1)i[r].m(e,t);a(e,r,t)},p(e,t){if(e.selectedCrime||e.values){let o;for(n=t.values,o=0;o<n.length;o+=1){const s=J(t,n,o);i[o]?i[o].p(e,s):(i[o]=U(s),i[o].c(),i[o].m(r.parentNode,r))}for(;o<i.length;o+=1)i[o].d(1);i.length=n.length}},i:e,o:e,d(e){!function(e,t){for(let r=0;r<e.length;r+=1)e[r]&&e[r].d(t)}(i,e),e&&c(r)}}}function R(e,t,r){let{values:n,selectedCrime:i}=t;const o=y();function s(e){o("click",e)}return e.$set=(e=>{"values"in e&&r("values",n=e.values),"selectedCrime"in e&&r("selectedCrime",i=e.selectedCrime)}),{values:n,selectedCrime:i,handleClick:s,click_handler:({crime:e})=>s(e)}}class V extends G{constructor(e){super(),O(this,e,R,X,o,["values","selectedCrime"])}}const W=async e=>{var t=new URL("https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer/find"),r={text:e,f:"json"};Object.keys(r).forEach(e=>t.searchParams.append(e,r[e]));const n=await fetch(t);return await n.json()};function K(e){var t,r,n,i,o,p,v=new F({props:{crimes:e.values,selectedCrime:e.selectedCrime}});v.$on("selected",e.listClickHandler);var h=new V({props:{values:e.values,selectedCrime:e.selectedCrime}});return h.$on("click",e.listClickHandler),{c(){t=l("header"),r=u(e.name),n=d(),v.$$.fragment.c(),i=d(),o=l("aside"),h.$$.fragment.c(),f(t,"class","svelte-ihai6f"),f(o,"id","sidebar"),f(o,"class","svelte-ihai6f")},m(e,c){a(e,t,c),s(t,r),a(e,n,c),P(v,e,c),a(e,i,c),a(e,o,c),P(h,o,null),p=!0},p(e,t){p&&!e.name||m(r,t.name);var n={};e.values&&(n.crimes=t.values),e.selectedCrime&&(n.selectedCrime=t.selectedCrime),v.$set(n);var i={};e.values&&(i.values=t.values),e.selectedCrime&&(i.selectedCrime=t.selectedCrime),h.$set(i)},i(e){p||(A(v.$$.fragment,e),A(h.$$.fragment,e),p=!0)},o(e){M(v.$$.fragment,e),M(h.$$.fragment,e),p=!1},d(e){e&&(c(t),c(n)),T(v,e),e&&(c(i),c(o)),T(h)}}}function Q(e,t,r){let{name:n,values:i=[],selectedCrime:o=!1}=t;const s=e=>{let t=Math.abs(new Date-new Date(e)),r=10;return t<36e5?r=30:t<72e5&&(r=20),r},a=(e,t)=>Array.prototype.slice.call(t.querySelectorAll(e));return g(async function(){r("values",i=await(async()=>{const e=await fetch("https://jsonp.afeld.me?url=http://www.slmpd.org/cfs.aspx"),t=await e.text();var r=(new DOMParser).parseFromString(t,"text/html");const n=a("table tbody tr",r);return Promise.all(n.map(async e=>{const[t,r,n,i]=a("td",e).map(e=>e.querySelector("font").innerHTML),o=n.replace("XX ","00 ").replace(" / "," and ")+", St. Louis, MO, USA",c=await W(o);let l=!1,u=!1;return c.locations.length>0&&c.locations[0].feature.attributes.Score>90&&(l=c.locations[0].feature.geometry.y,u=c.locations[0].feature.geometry.x),{date:t,id:r,address:o,offense:i,size:s(t),lat:l,lon:u}}))})())}),e.$set=(e=>{"name"in e&&r("name",n=e.name),"values"in e&&r("values",i=e.values),"selectedCrime"in e&&r("selectedCrime",o=e.selectedCrime)}),{name:n,values:i,selectedCrime:o,listClickHandler:function(e){o==e.detail||!1===e.detail?r("selectedCrime",o=!1):r("selectedCrime",o=e.detail)}}}return new class extends G{constructor(e){super(),O(this,e,Q,K,o,["name","values","selectedCrime"])}}({target:document.body,props:{name:"St. Louis Live Crime",values:[]}})}();
//# sourceMappingURL=bundle.js.map
